defmodule Mockchain.GenesisFactory do
  alias Mockchain.Account, as: Account

  @spec testnet() :: Mockchain.Block.t()
  def testnet() do
    genesis(genesis_accounts(), genesis_transactions(genesis_miner()), genesis_miner())
  end

  def testnet_parent() do
    genesis_parent(genesis_state(genesis_accounts()))
  end

  defp addrBalance(addr, balance) do
    {Wallet.from_address(addr), %Account{balance: balance}}
  end

  defp addrAccount(addr, account) do
    {Wallet.from_address(addr), account}
  end

  @spec genesis_accounts() :: [{Wallet.t(), Account.t()}]
  def genesis_accounts() do
    accountant = 0x96CDE043E986040CB13FFAFD80EB8CEAC196FB84

    [
      # The Accountant
      addrBalance(accountant, ether(1000)),
      # The Faucet
      addrBalance(0x0000E2A26F1D463A254A8750C24774AEB0BC990F, ether(1000)),
      # Reserved A-D
      addrBalance(0x34E3961098DE3348B465CC82791BD0F7EBCE3ECD, ether(1000)),
      addrBalance(0xC0C416B326133D74335E6828D558EFE315BD597E, ether(1000)),
      addrBalance(0x58CC80F5526594F07F33FD4BE4AEF153BAB602B2, ether(1000)),
      addrBalance(0x45AA0730CF4216F7195FC1F5903A171A1FAA5209, ether(1000)),

      # The Registry with the accountant placed
      addrAccount(
        Diode.registryAddress(),
        %Account{
          balance: ether(100_000_000),
          code: Base16.decode(registryContract())
        }
        |> Account.storageSetValue(1, accountant)
      )
    ]
  end

  def genesis_miner() do
    Wallet.from_privkey(
      <<149, 210, 74, 221, 235, 25, 240, 87, 85, 95, 119, 147, 106, 182, 149, 28, 112, 227, 22,
        173, 235, 134, 113, 172, 125, 222, 191, 154, 120, 128, 129, 203>>
    )
  end

  @spec genesis_transactions(Wallet.t()) :: [Mockchain.Transaction.t(), ...]
  def genesis_transactions(miner) do
    # Call "blockReward()":
    priv = miner |> Wallet.privkey!()

    tx =
      %Mockchain.Transaction{
        nonce: 0,
        gasPrice: 0,
        gasLimit: 1_000_000_000,
        to: Diode.registryAddress(),
        data: ABI.encode_spec("blockReward")
      }
      |> Mockchain.Transaction.sign(priv)

    [tx]
  end

  @spec genesis_parent(Mockchain.State.t()) :: Mockchain.Block.t()
  def genesis_parent(state) do
    %Mockchain.Block{
      header: %Mockchain.Header{
        block_hash: nil,
        state_hash: Mockchain.State.hash(state)
      }
    }
  end

  def genesis_state(accounts) do
    Enum.reduce(accounts, Mockchain.State.new(), fn {wallet, user_account}, state ->
      Mockchain.State.set_account(state, Wallet.address!(wallet), user_account)
    end)
  end

  @spec genesis(any(), [Mockchain.Transaction.t()], Wallet.t()) :: Mockchain.Block.t()
  def genesis(accounts, transactions, miner) do
    state = genesis_state(accounts)
    Mockchain.state_store(state)

    parent = genesis_parent(state)
    block = Mockchain.Block.create(parent, transactions, miner, 1_555_510_594)
    header = Mockchain.Block.header(block)

    header =
      %{header | miner_signature: <<0::520>>}
      |> Mockchain.Header.update_hash()

    %{block | header: header}
  end

  defp ether(x) do
    Shell.ether(x)
  end

  defp registryContract() do
    "0x6080604052600436106100f85763ffffffff60e060020a6000350416630a938dff81146100fd5780630ac168a1146101365780631dd447061461014d57806337e66906146101625780634ab9ef82146101ee5780634fb3ccc514610252578063534a2422146102835780636f9874a4146102975780637211b9a9146102ac5780637fca4a29146102cc5780638d23fc61146102ed5780638da5cb5b1461030e5780639a3eba6c14610323578063acc77cba14610343578063b0128d9214610357578063be3bb93c1461036f578063c487e3f714610396578063c4a9e1161461039e578063c76a1173146103b3578063cb106cf8146103d7575b600080fd5b34801561010957600080fd5b5061012460ff60043516600160a060020a03602435166103ec565b60408051918252519081900360200190f35b34801561014257600080fd5b5061014b610659565b005b34801561015957600080fd5b5061014b610826565b34801561016e57600080fd5b5060408051606081810190925261014b916004803592600160a060020a0360243581169360443582169360643593608435909316923692610104919060a49060039083908390808284375050604080516060818101909252949796958181019594509250600391508390839080828437509396506109df95505050505050565b3480156101fa57600080fd5b5060408051606081810190925261014b916004803592600160a060020a036024358116936044359091169260643592608435923692916101049160a490600390839083908082843750939650610ea395505050505050565b34801561025e57600080fd5b50610267611174565b60408051600160a060020a039092168252519081900360200190f35b61014b600160a060020a0360043516611183565b3480156102a357600080fd5b50610124611263565b3480156102b857600080fd5b5061014b600480356024810191013561126d565b3480156102d857600080fd5b5061014b600160a060020a03600435166113f1565b3480156102f957600080fd5b50610267600160a060020a0360043516611639565b34801561031a57600080fd5b50610267611654565b34801561032f57600080fd5b5061014b6004803560248101910135611663565b61014b600160a060020a036004351661185b565b34801561036357600080fd5b5061014b6004356119ad565b34801561037b57600080fd5b5061012460ff60043516600160a060020a0360243516611a76565b61014b611a89565b3480156103aa57600080fd5b50610124611a95565b3480156103bf57600080fd5b5061014b600160a060020a0360043516602435611a9b565b3480156103e357600080fd5b50610124611b7c565b600060ff8316151561047757600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611b82565b9050610653565b8260ff16600114156104fb57600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611b91565b8260ff166002141561057f57600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611ba0565b8260ff166003141561060357600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611baf565b6040805160e560020a62461bcd02815260206004820152601260248201527f556e68616e646c656420617267756d656e740000000000000000000000000000604482015290519081900360640190fd5b92915050565b6000808080803341146106dc576040805160e560020a62461bcd02815260206004820152603060248201527f4f6e6c7920746865206d696e6572206f662074686520626c6f636b2063616e2060448201527f63616c6c2074686973206d6574686f6400000000000000000000000000000000606482015290519081900360840190fd5b6106e4611263565b600754146106f4576106f4611bbe565b674563918244f40000945061071a416107158761271063ffffffff611e4216565b611e7b565b600093505b60085484101561081357600880548590811061073757fe5b6000918252602080832090910154600160a060020a031680835260099091526040909120549093506107719061271063ffffffff611f4216565b915061077e600084611f65565b9050662386f26fc100008110156107995750662386f26fc100005b808211156107a5578091505b60008211156107ef576107b88383612179565b6040518290600160a060020a038516907fc083a1647e3ee591bf42b82564ffb4d16fdbb26068f0080da911c8d8300fd84a90600090a35b600160a060020a03831660009081526009602052604081205560019093019261071f565b61081f60086000612cba565b5050505050565b336000818152600560208181526040808420815160a08101835281548184019081526001830154606080840191909152600284015460808401529082528351908101845260038301548152600483015481860152948201549285019290925291810192909252919061089790611baf565b9050600081116108f1576040805160e560020a62461bcd02815260206004820152601060248201527f43616e2774207769746864726177203000000000000000000000000000000000604482015290519081900360640190fd5b6040805160a0810182528354818301908152600185015460608084019190915260028601546080840152908252825190810183526003850154815260048501546020828101919091526005860154938201939093529181019190915261095d908263ffffffff61224e16565b600160a060020a0384166000818152600560208181526040808420865180518255808401516001830155820151600282015595820151805160038801559182015160048701559081015194909101939093559151909183156108fc02918491818181858888f193505050501580156109d9573d6000803e3d6000fd5b50505050565b6060600081818a438110610a3d576040805160e560020a62461bcd02815260206004820152601760248201527f5469636b65742066726f6d20746865206675747572653f000000000000000000604482015290519081900360640190fd5b600754610a5e600f6224ea005b849162ffffff91041663ffffffff611f4216565b14610ab3576040805160e560020a62461bcd02815260206004820152600b60248201527f57726f6e672065706f6368000000000000000000000000000000000000000000604482015290519081900360640190fd5b60408051600580825260c08201909252906020820160a080388339505081519196508d918791506000908110610ae557fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8d02169086906001908110610b1557fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8c02169086906002908110610b4557fe5b602090810290910101528451899086906003908110610b6057fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8a02169086906004908110610b9057fe5b602090810290910101526001610ba5866122db565b6040808a01518a516020808d0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af1158015610c07573d6000803e3d6000fd5b505050602060405103519350610c1d8b85612439565b60408051600580825260c08201909252906020820160a080388339505081519194508d918591506000908110610c4f57fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8d02169084906001908110610c7f57fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8c02169084906002908110610caf57fe5b602090810290910101528251899084906003908110610cca57fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8a02169084906004908110610cfa57fe5b60209081029190910101528651835184906005908110610d1657fe5b602090810290910101528660016020020151836006815181101515610d3757fe5b60209081029190910101526040870151835184906007908110610d5657fe5b602090810290910101526001610d6b846122db565b60408089015189516020808c0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af1158015610dcd573d6000803e3d6000fd5b5050604051601f190151925050600160a060020a0380831690891614610e3d576040805160e560020a62461bcd02815260206004820152601d60248201527f496e76616c69642064657374696e6174696f6e207369676e6174757265000000604482015290519081900360640190fd5b610e4b8b8b8660008d612525565b83600160a060020a03168a600160a060020a03168c600160a060020a03167f2f32d98de74c460cec31bf6c23c3577dc12eca03deb34040e3efe13e3f2dde4260405160405180910390a4505050505050505050505050565b6060600087438110610eff576040805160e560020a62461bcd02815260206004820152601760248201527f5469636b65742066726f6d20746865206675747572653f000000000000000000604482015290519081900360640190fd5b600754610f10600f6224ea00610a4a565b14610f65576040805160e560020a62461bcd02815260206004820152600b60248201527f57726f6e672065706f6368000000000000000000000000000000000000000000604482015290519081900360640190fd5b851515610fbc576040805160e560020a62461bcd02815260206004820152601460248201527f496e76616c6964207469636b65742076616c7565000000000000000000000000604482015290519081900360640190fd5b60408051600580825260c08201909252906020820160a080388339505081519194508a918591506000908110610fee57fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8a0216908490600190811061101e57fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a890216908490600290811061104e57fe5b60209081029091010152825186908490600390811061106957fe5b60209081029091010152825185908490600490811061108457fe5b602090810290910101526001611099846122db565b60408087015187516020808a0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af11580156110fb573d6000803e3d6000fd5b5050506020604051035191506111118883612439565b61111f888884896000612525565b81600160a060020a031687600160a060020a031689600160a060020a03167f39e078a40cc33b8ec6630e5592b3b83cd797752d5f4fba4e0da338160c1a368760405160405180910390a4505050505050505050565b600154600160a060020a031681565b600061118e8261274a565b600160a060020a038116600090815260066020908152604091829020825160a081018452815481850190815260018301546060808401919091526002840154608084015290825284519081018552600383015481526004830154818501526005909201549382019390935290820152909150611210903463ffffffff61295816565b600160a060020a0390911660009081526006602090815260409182902083518051825580830151600183015583015160028201559281015180516003850155908101516004840155015160059091015550565b6202760043065b90565b6000611277612cdb565b82158061128657506008830615155b156112db576040805160e560020a62461bcd02815260206004820152601560248201527f496e76616c6964207469636b6574206c656e6774680000000000000000000000604482015290519081900360640190fd5b600091505b600883048210156109d95760408051606081019091528085856005860181811061130657fe5b602090810292909201358352500185856006860181811061132357fe5b602090810292909201358352500185856007860181811061134057fe5b60200291909101359091525090506113e684848481811061135d57fe5b6020029190910135905085856001860181811061137657fe5b9050602002013560001916606060020a9004868686600201818110151561139957fe5b9050602002013560001916606060020a900487878760030181811015156113bc57fe5b602002919091013590508888600489018181106113d557fe5b905060200201356000191686610ea3565b6001909101906112e0565b6000806000806114008561274a565b935083600160a060020a0316634fb3ccc56040518163ffffffff1660e060020a028152600401602060405180830381600087803b15801561144057600080fd5b505af1158015611454573d6000803e3d6000fd5b505050506040513d602081101561146a57600080fd5b5051600160a060020a038516600090815260066020908152604091829020825160a081018452815481850190815260018301546060808401919091526002840154608084015290825284519081018552600383015481526004830154818501526005830154948101949094529182019290925291945092506114eb90611baf565b905060008111611545576040805160e560020a62461bcd02815260206004820152601060248201527f43616e2774207769746864726177203000000000000000000000000000000000604482015290519081900360640190fd5b6040805160a081018252835481830190815260018501546060808401919091526002860154608084015290825282519081018352600385015481526004850154602082810191909152600586015493820193909352918101919091526115b1908263ffffffff61224e16565b600160a060020a038086166000908152600660209081526040808320855180518255808401516001830155820151600282015594820151805160038701559182015160048601559081015160059094019390935591519085169183156108fc02918491818181858888f19350505050158015611631573d6000803e3d6000fd5b505050505050565b600460205260009081526040902054600160a060020a031681565b600054600160a060020a031681565b600061166d612cdb565b611675612cdb565b8315806116845750600b840615155b156116d9576040805160e560020a62461bcd02815260206004820152601d60248201527f496e76616c69642074726166666963207469636b6574206c656e677468000000604482015290519081900360640190fd5b600092505b600b840483101561081f5760408051606081019091528086866005870181811061170457fe5b602090810292909201358352500186866006870181811061172157fe5b602090810292909201358352500186866007870181811061173e57fe5b60200291909101359091525060408051606081019091529092508086866008870181811061176857fe5b602090810292909201358352500186866009870181811061178557fe5b60209081029290920135835250018686600a87018181106117a257fe5b60200291909101359091525090506118508585858181106117bf57fe5b602002919091013590508686600187018181106117d857fe5b9050602002013560001916606060020a900487878760020181811015156117fb57fe5b9050602002013560001916606060020a9004888888600301818110151561181e57fe5b60200291909101359050898960048a0181811061183757fe5b9050602002013560001916606060020a900487876109df565b6001909201916116de565b600154600090600160a060020a0316331461187557600080fd5b600160a060020a03828116600090815260046020526040902054161561190b576040805160e560020a62461bcd02815260206004820152602560248201527f44656c656761746520616c726561647920686173206120666c65657420636f6e60448201527f7472616374000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60015430908390600160a060020a0316611923612cfa565b600160a060020a03938416815291831660208301529091166040808301919091525190819003606001906000f080158015611962573d6000803e3d6000fd5b50600160a060020a038381166000908152600460205260409020805473ffffffffffffffffffffffffffffffffffffffff191691831691909117905590506119a981611183565b5050565b33600081815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152611a24908363ffffffff61297b16565b600160a060020a03909116600090815260056020818152604092839020845180518255808301516001830155840151600282015593810151805160038601559081015160048501559091015191015550565b6000611a828383611f65565b9392505050565b611a933334612a36565b565b60025481565b6000611aa68361274a565b600160a060020a038116600090815260066020908152604091829020825160a081018452815481850190815260018301546060808401919091526002840154608084015290825284519081018552600383015481526004830154818501526005909201549382019390935290820152909150611b28908363ffffffff61297b16565b600160a060020a039091166000908152600660209081526040918290208351805182558083015160018301558301516002820155928101518051600385015590810151600484015501516005909101555050565b60035481565b60006106538260000151612ab6565b60006106538260000151612acd565b60006106538260200151612acd565b60006106538260200151612ab6565b6000808080808080808080805b600a54891015611e1e57600a80548a908110611be357fe5b600091825260209091200154600160a060020a03169750611c0388612ae1565b9650611c1687606463ffffffff611f4216565b600160a060020a0389166000908152600b602052604090206001810154919b509650611c5f90611c4e9061040063ffffffff611e4216565b60028801549063ffffffff612b5b16565b9450600093505b6003860154841015611dd55760038601805485908110611c8257fe5b6000918252602080832090910154600160a060020a03168083526004890190915260409091206001810154919c509350611cd990611cc89061040063ffffffff611e4216565b60028501549063ffffffff612b5b16565b9150611d0d85611d018c611cf58661271063ffffffff611e4216565b9063ffffffff611e4216565b9063ffffffff611f4216565b9150611d198b83611e7b565b5060005b6003830154811015611d8a578260040160008460030183815481101515611d4057fe5b6000918252602080832090910154600160a060020a031683528201929092526040018120805460ff1916815560018181018390556002820183905560039091019190915501611d1d565b600160a060020a038b1660009081526004870160205260408120805460ff19168155600181018290556002810182905590611dc86003830182612cba565b5050600190930192611c66565b600160a060020a0388166000908152600b60205260408120805460ff19168155600181018290556002810182905590611e116003830182612cba565b5050600190980197611bcb565b611e2a600a6000612cba565b611e32611263565b6007555050505050505050505050565b600080831515611e555760009150611e74565b50828202828482811515611e6557fe5b0414611e7057600080fd5b8091505b5092915050565b60008111156119a957600160a060020a0382166000908152600960205260409020541515611efc57600880546001810182556000919091527ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee301805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0384161790555b600160a060020a038216600090815260096020526040902054611f25908263ffffffff612b5b16565b600160a060020a0383166000908152600960205260409020555050565b600080808311611f5157600080fd5b8284811515611f5c57fe5b04949350505050565b600060ff83161515611fea57600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611b82565b8260ff166001141561206f57600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611b91565b8260ff16600214156120f457600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611ba0565b8260ff166003141561060357600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611baf565b600160a060020a038216600090815260056020818152604092839020835160a081018552815481860190815260018301546060808401919091526002840154608084015290825285519081018652600383015481526004830154818501529190930154938101939093528101919091526121f9908263ffffffff612b6d16565b600160a060020a03909216600090815260056020818152604092839020855180518255808301516001830155840151600282015594810151805160038701559081015160048601559091015192019190915550565b612256612d0a565b816122648460200151612ab6565b10156122ba576040805160e560020a62461bcd02815260206004820152601660248201527f496e737566666963656e742066726565207374616b6500000000000000000000604482015290519081900360640190fd5b60208301516122cf908363ffffffff612b9816565b60208401525090919050565b600080606060008085519350836020026040519080825280601f01601f191660200182016040528015612318578160200160208202803883390190505b509250600091505b838210156123d3575060005b60208110156123c857858281518110151561234357fe5b906020019060200201518160208110151561235a57fe5b1a7f0100000000000000000000000000000000000000000000000000000000000000028382846020020181518110151561239057fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060010161232c565b600190910190612320565b826040518082805190602001908083835b602083106124035780518252601f1990920191602091820191016123e4565b5181516020939093036101000a600019018019909116921691909117905260405192018290039091209998505050505050505050565b604080517fd90bd651000000000000000000000000000000000000000000000000000000008152600160a060020a0383811660048301529151849283169163d90bd6519160248083019260209291908290030181600087803b15801561249e57600080fd5b505af11580156124b2573d6000803e3d6000fd5b505050506040513d60208110156124c857600080fd5b50511515612520576040805160e560020a62461bcd02815260206004820152601360248201527f556e726567697374657265642064657669636500000000000000000000000000604482015290519081900360640190fd5b505050565b600160a060020a0385166000908152600b60205260408120805490919081908190819060ff1615156125b4578454600160ff1990911681178655600a805491820181556000527fc65a7bb8d6351c1cf70c95a316cc6a92839c986682d98bc35f958f4883f9d2a801805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038c161790555b600160a060020a03891660009081526004860160205260409020805490945060ff161515612626578354600160ff1990911681178555600386018054918201815560009081526020902001805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038b161790555b600160a060020a03881660009081526004850160205260409020805490935060ff161515612698578254600160ff1990911681178455600385018054918201815560009081526020902001805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038a161790555b82600201548711156126eb576002830180549088905560018501549088900392506126c9908363ffffffff612b5b16565b6001808601919091558501546126e5908363ffffffff612b5b16565b60018601555b826003015486111561273e5750600382018054908690556002840154908690039061271c908263ffffffff612b5b16565b600280860191909155850154612738908263ffffffff612b5b16565b60028601555b50505050505050505050565b600160a060020a038082166000908152600460205260408120549091168181156127fb57600154600160a060020a031633146127f6576040805160e560020a62461bcd02815260206004820152602660248201527f4f6e6c79207468652063726f6e206163636f756e74616e742063616e2063616c60448201527f6c20746869730000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b611e74565b61280d84600160a060020a0316612c1d565b1515612863576040805160e560020a62461bcd02815260206004820152601e60248201527f496e76616c696420666c65657420636f6e747261637420616464726573730000604482015290519081900360640190fd5b83915081600160a060020a0316634fb3ccc56040518163ffffffff1660e060020a028152600401602060405180830381600087803b1580156128a457600080fd5b505af11580156128b8573d6000803e3d6000fd5b505050506040513d60208110156128ce57600080fd5b50519050600160a060020a0381163314611e74576040805160e560020a62461bcd02815260206004820152602560248201527f4f6e6c792074686520666c656574206163636f756e74616e742063616e20646f60448201527f2074686973000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b612960612d0a565b8251612972908363ffffffff612c2516565b83525090919050565b612983612d0a565b816129918460000151612ab6565b1015612a0d576040805160e560020a62461bcd02815260206004820152602160248201527f43616e277420756e7374616b65206d6f7265207468616e206973207374616b6560448201527f6400000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b8251612a1f908363ffffffff612b9816565b835260208301516122cf908363ffffffff612c2516565b600160a060020a038216600090815260056020818152604092839020835160a081018552815481860190815260018301546060808401919091526002840154608084015290825285519081018652600383015481526004830154818501529190930154938101939093528101919091526121f9908263ffffffff61295816565b6000612ac3826000612c25565b6040015192915050565b6000612ada826000612c25565b5192915050565b600160a060020a0381166000908152600660209081526040808320815160a08101835281548184019081526001830154606080840191909152600284015460808401529082528351908101845260038301548152600483015481860152600590920154928201929092529181019190915261065390611b82565b600082820183811015611e7057600080fd5b612b75612d0a565b825160400151612b8b908363ffffffff612b5b16565b8351604001525090919050565b612ba0612d30565b612bab836000612c25565b905081816040015110151515612c0b576040805160e560020a62461bcd02815260206004820152601b60248201527f496e737566666963656e742066756e647320746f206465647563740000000000604482015290519081900360640190fd5b60408101805192909203909152919050565b6000903b1190565b612c2d612d30565b612c3683612ca9565b1515612c7257604080516060810182528381524360208201528451858301519192830191612c699163ffffffff612b5b16565b90529050610653565b604080516060810190915283518190612c91908563ffffffff612b5b16565b81524360208201526040858101519101529050610653565b602001516202ac6043919091031090565b5080546000825590600052602060002090810190612cd89190612d52565b50565b6060604051908101604052806003906020820280388339509192915050565b60405161048480612d7183390190565b60c060405190810160405280612d1e612d30565b8152602001612d2b612d30565b905290565b6060604051908101604052806000815260200160008152602001600081525090565b61126a91905b80821115612d6c5760008155600101612d58565b50905600608060405234801561001057600080fd5b5060405160608061048483398101604090815281516020830151919092015160018054600160a060020a03938416600160a060020a03199182161790915560008054948416948216949094179093556002805492909116919092161790556104078061007d6000396000f3006080604052600436106100ae5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416633c5f7d4681146100b35780634fb3ccc5146100db57806364c69c7d1461010c57806376bd31a8146101415780638da5cb5b14610162578063a0619d4a14610177578063a58bbebd14610198578063b13aa78a146101be578063b655bd5f146101df578063b92c8c8014610205578063d90bd6511461022b575b600080fd5b3480156100bf57600080fd5b506100d9600160a060020a0360043516602435151561024c565b005b3480156100e757600080fd5b506100f061028e565b60408051600160a060020a039092168252519081900360200190f35b34801561011857600080fd5b5061012d600160a060020a036004351661029d565b604080519115158252519081900360200190f35b34801561014d57600080fd5b5061012d600160a060020a03600435166102b2565b34801561016e57600080fd5b506100f06102c7565b34801561018357600080fd5b5061012d600160a060020a03600435166102d6565b3480156101a457600080fd5b506100d9600160a060020a036004351660243515156102eb565b3480156101ca57600080fd5b5061012d600160a060020a036004351661032d565b3480156101eb57600080fd5b506100d9600160a060020a03600435166024351515610342565b34801561021157600080fd5b506100d9600160a060020a03600435166024351515610384565b34801561023757600080fd5b5061012d600160a060020a03600435166103c6565b600154600160a060020a0316331461026357600080fd5b600160a060020a03919091166000908152600860205260409020805460ff1916911515919091179055565b600254600160a060020a031681565b60096020526000908152604090205460ff1681565b60066020526000908152604090205460ff1681565b600154600160a060020a031681565b600a6020526000908152604090205460ff1681565b600154600160a060020a0316331461030257600080fd5b600160a060020a03919091166000908152600a60205260409020805460ff1916911515919091179055565b60076020526000908152604090205460ff1681565b600154600160a060020a0316331461035957600080fd5b600160a060020a03919091166000908152600760205260409020805460ff1916911515919091179055565b600154600160a060020a0316331461039b57600080fd5b600160a060020a03919091166000908152600960205260409020805460ff1916911515919091179055565b60086020526000908152604090205460ff16815600a165627a7a7230582068e71914f0520e516858cedb88c18ccc48f386c0b117656a98208c3e1bd760c60029a165627a7a723058207920e4ec4f199af504d2f6602f1f06badab101014fb7d4fb0e74bf8729bdc1620029"
  end
end

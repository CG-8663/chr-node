defmodule Chain.GenesisFactory do
  alias Chain.Account, as: Account

  @spec testnet() :: Chain.Block.t()
  def testnet() do
    genesis(genesis_accounts(), genesis_transactions(genesis_miner()), genesis_miner())
  end

  def testnet_parent() do
    genesis_parent(genesis_state(genesis_accounts()), genesis_miner())
  end

  defp addrBalance(addr, balance) do
    {Wallet.from_address(addr), %Account{balance: balance}}
  end

  defp addrAccount(addr, account) do
    {Wallet.from_address(addr), account}
  end

  @spec genesis_accounts() :: [{Wallet.t(), Account.t()}]
  def genesis_accounts() do
    accountant = 0x96CDE043E986040CB13FFAFD80EB8CEAC196FB84

    [
      # The Accountant
      addrBalance(accountant, ether(1000)),
      # The Faucet
      addrBalance(0x0000E2A26F1D463A254A8750C24774AEB0BC990F, ether(1000)),
      # Reserved A-D
      addrBalance(0x34E3961098DE3348B465CC82791BD0F7EBCE3ECD, ether(1000)),
      addrBalance(0xC0C416B326133D74335E6828D558EFE315BD597E, ether(1000)),
      addrBalance(0x58CC80F5526594F07F33FD4BE4AEF153BAB602B2, ether(1000)),
      addrBalance(0x45AA0730CF4216F7195FC1F5903A171A1FAA5209, ether(1000)),

      # The Registry with the accountant placed
      addrAccount(
        Diode.registryAddress(),
        %Account{
          balance: ether(100_000_000),
          code: Base16.decode(registryContract())
        }
        |> Account.storageSetValue(1, accountant)
      )
    ]
  end

  def genesis_miner() do
    Wallet.from_privkey(
      <<149, 210, 74, 221, 235, 25, 240, 87, 85, 95, 119, 147, 106, 182, 149, 28, 112, 227, 22,
        173, 235, 134, 113, 172, 125, 222, 191, 154, 120, 128, 129, 203>>
    )
  end

  @spec genesis_transactions(Wallet.t()) :: [Chain.Transaction.t(), ...]
  def genesis_transactions(miner) do
    # Call "blockReward()":
    priv = miner |> Wallet.privkey!()

    tx =
      %Chain.Transaction{
        nonce: 0,
        gasPrice: 0,
        gasLimit: 1_000_000_000,
        to: Diode.registryAddress(),
        data: ABI.encode_spec("blockReward")
      }
      |> Chain.Transaction.sign(priv)

    [tx]
  end

  @spec genesis_parent(Chain.State.t(), Wallet.t()) :: Chain.Block.t()
  def genesis_parent(state, miner) do
    %Chain.Block{
      header: %Chain.Header{
        block_hash: nil,
        state_hash: Chain.State.hash(state),
        miner_pubkey: Wallet.pubkey!(miner)
      }
    }
  end

  def genesis_state(accounts) do
    Enum.reduce(accounts, Chain.State.new(), fn {wallet, user_account}, state ->
      Chain.State.set_account(state, Wallet.address!(wallet), user_account)
    end)
  end

  @spec genesis(any(), [Chain.Transaction.t()], Wallet.t()) :: Chain.Block.t()
  def genesis(accounts, transactions, miner) do
    state = genesis_state(accounts)
    Chain.state_store(state)

    parent = genesis_parent(state, miner)
    block = Chain.Block.create(parent, transactions, miner, 1_555_510_594)
    header = Chain.Block.header(block)

    header =
      %{header | miner_signature: <<0::520>>}
      |> Chain.Header.update_hash()

    %{block | header: header}
  end

  defp ether(x) do
    Shell.ether(x)
  end

  defp registryContract() do
    "0x6080604052600436106100f85763ffffffff60e060020a6000350416630a938dff81146100fd5780630ac168a1146101365780631dd447061461014d57806337e66906146101625780634fb3ccc5146101ee578063534a24221461021f5780636f9874a4146102335780637211b9a9146102485780637fca4a29146102685780638d23fc61146102895780638da5cb5b146102aa5780639a3eba6c146102bf578063acc77cba146102df578063b0128d92146102f3578063be3bb93c1461030b578063c1e4d72014610332578063c487e3f714610396578063c4a9e1161461039e578063c76a1173146103b3578063cb106cf8146103d7575b600080fd5b34801561010957600080fd5b5061012460ff60043516600160a060020a03602435166103ec565b60408051918252519081900360200190f35b34801561014257600080fd5b5061014b610659565b005b34801561015957600080fd5b5061014b6108b0565b34801561016e57600080fd5b5060408051606081810190925261014b916004803592600160a060020a0360243581169360443582169360643593608435909316923692610104919060a4906003908390839080828437505060408051606081810190925294979695818101959450925060039150839083908082843750939650610a6995505050505050565b3480156101fa57600080fd5b50610203610f2d565b60408051600160a060020a039092168252519081900360200190f35b61014b600160a060020a0360043516610f3c565b34801561023f57600080fd5b5061012461101c565b34801561025457600080fd5b5061014b6004803560248101910135611026565b34801561027457600080fd5b5061014b600160a060020a0360043516611194565b34801561029557600080fd5b50610203600160a060020a03600435166113dc565b3480156102b657600080fd5b506102036113f7565b3480156102cb57600080fd5b5061014b6004803560248101910135611406565b61014b600160a060020a03600435166115fb565b3480156102ff57600080fd5b5061014b60043561174d565b34801561031757600080fd5b5061012460ff60043516600160a060020a0360243516611816565b34801561033e57600080fd5b5060408051606081810190925261014b916004803592600160a060020a036024358116936044359091169260643592608435923692916101049160a49060039083908390808284375093965061182995505050505050565b61014b611ae2565b3480156103aa57600080fd5b50610124611aee565b3480156103bf57600080fd5b5061014b600160a060020a0360043516602435611af4565b3480156103e357600080fd5b50610124611bd5565b600060ff8316151561047757600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611bdb565b9050610653565b8260ff16600114156104fb57600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611bea565b8260ff166002141561057f57600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611bf9565b8260ff166003141561060357600160a060020a038216600090815260066020908152604091829020825160a08101845281548185019081526001830154606080840191909152600284015460808401529082528451908101855260038301548152600483015481850152600590920154938201939093529082015261047090611c08565b6040805160e560020a62461bcd02815260206004820152601260248201527f556e68616e646c656420617267756d656e740000000000000000000000000000604482015290519081900360640190fd5b92915050565b60008080808033411480159061066e57504115155b156106e9576040805160e560020a62461bcd02815260206004820152603060248201527f4f6e6c7920746865206d696e6572206f662074686520626c6f636b2063616e2060448201527f63616c6c2074686973206d6574686f6400000000000000000000000000000000606482015290519081900360840190fd5b334114610766576040805160e560020a62461bcd02815260206004820152603060248201527f4f6e6c7920746865206d696e6572206f662074686520626c6f636b2063616e2060448201527f63616c6c2074686973206d6574686f6400000000000000000000000000000000606482015290519081900360840190fd5b61076e61101c565b6007541461077e5761077e611c17565b674563918244f4000094506107a44161079f8761271063ffffffff611e9b16565b611ed4565b600093505b60085484101561089d5760088054859081106107c157fe5b6000918252602080832090910154600160a060020a031680835260099091526040909120549093506107fb9061271063ffffffff611f9b16565b9150610808600084611fbe565b9050662386f26fc100008110156108235750662386f26fc100005b8082111561082f578091505b60008211156108795761084283836121d2565b6040518290600160a060020a038516907fc083a1647e3ee591bf42b82564ffb4d16fdbb26068f0080da911c8d8300fd84a90600090a35b600160a060020a0383166000908152600960205260408120556001909301926107a9565b6108a960086000612d11565b5050505050565b336000818152600560208181526040808420815160a08101835281548184019081526001830154606080840191909152600284015460808401529082528351908101845260038301548152600483015481860152948201549285019290925291810192909252919061092190611c08565b90506000811161097b576040805160e560020a62461bcd02815260206004820152601060248201527f43616e2774207769746864726177203000000000000000000000000000000000604482015290519081900360640190fd5b6040805160a081018252835481830190815260018501546060808401919091526002860154608084015290825282519081018352600385015481526004850154602082810191909152600586015493820193909352918101919091526109e7908263ffffffff6122a716565b600160a060020a0384166000818152600560208181526040808420865180518255808401516001830155820151600282015595820151805160038801559182015160048701559081015194909101939093559151909183156108fc02918491818181858888f19350505050158015610a63573d6000803e3d6000fd5b50505050565b6060600081818a438110610ac7576040805160e560020a62461bcd02815260206004820152601760248201527f5469636b65742066726f6d20746865206675747572653f000000000000000000604482015290519081900360640190fd5b600754610ae8600f6224ea005b849162ffffff91041663ffffffff611f9b16565b14610b3d576040805160e560020a62461bcd02815260206004820152600b60248201527f57726f6e672065706f6368000000000000000000000000000000000000000000604482015290519081900360640190fd5b60408051600580825260c08201909252906020820160a080388339505081519196508d918791506000908110610b6f57fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8d02169086906001908110610b9f57fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8c02169086906002908110610bcf57fe5b602090810290910101528451899086906003908110610bea57fe5b6020908102909101015284516bffffffffffffffffffffffff19606060020a8a02169086906004908110610c1a57fe5b602090810290910101526001610c2f86612334565b6040808a01518a516020808d0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af1158015610c91573d6000803e3d6000fd5b505050602060405103519350610ca78b85612492565b60408051600580825260c08201909252906020820160a080388339505081519194508d918591506000908110610cd957fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8d02169084906001908110610d0957fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8c02169084906002908110610d3957fe5b602090810290910101528251899084906003908110610d5457fe5b6020908102909101015282516bffffffffffffffffffffffff19606060020a8a02169084906004908110610d8457fe5b60209081029190910101528651835184906005908110610da057fe5b602090810290910101528660016020020151836006815181101515610dc157fe5b60209081029190910101526040870151835184906007908110610de057fe5b602090810290910101526001610df584612334565b60408089015189516020808c0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af1158015610e57573d6000803e3d6000fd5b5050604051601f190151925050600160a060020a0380831690891614610ec7576040805160e560020a62461bcd02815260206004820152601d60248201527f496e76616c69642064657374696e6174696f6e207369676e6174757265000000604482015290519081900360640190fd5b610ed58b8b8660008d61257e565b83600160a060020a03168a600160a060020a03168c600160a060020a03167f2f32d98de74c460cec31bf6c23c3577dc12eca03deb34040e3efe13e3f2dde4260405160405180910390a4505050505050505050505050565b600154600160a060020a031681565b6000610f47826127a1565b600160a060020a038116600090815260066020908152604091829020825160a081018452815481850190815260018301546060808401919091526002840154608084015290825284519081018552600383015481526004830154818501526005909201549382019390935290820152909150610fc9903463ffffffff6129af16565b600160a060020a0390911660009081526006602090815260409182902083518051825580830151600183015583015160028201559281015180516003850155908101516004840155015160059091015550565b6202760043065b90565b6000611030612d32565b82158061103f57506008830615155b15611094576040805160e560020a62461bcd02815260206004820152601560248201527f496e76616c6964207469636b6574206c656e6774680000000000000000000000604482015290519081900360640190fd5b600091505b82821015610a63576040805160608101909152808585600586018181106110bc57fe5b60209081029290920135835250018585600686018181106110d957fe5b60209081029290920135835250018585600786018181106110f657fe5b602002919091013590915250905061118984848481811061111357fe5b6020029190910135905061113f86866001870181811061112f57fe5b9050602002013560001916611023565b61115187876002880181811061112f57fe5b87876003880181811061116057fe5b6020029190910135905088886004890181811061117957fe5b6020029190910135905086611829565b600882019150611099565b6000806000806111a3856127a1565b935083600160a060020a0316634fb3ccc56040518163ffffffff1660e060020a028152600401602060405180830381600087803b1580156111e357600080fd5b505af11580156111f7573d6000803e3d6000fd5b505050506040513d602081101561120d57600080fd5b5051600160a060020a038516600090815260066020908152604091829020825160a0810184528154818501908152600183015460608084019190915260028401546080840152908252845190810185526003830154815260048301548185015260058301549481019490945291820192909252919450925061128e90611c08565b9050600081116112e8576040805160e560020a62461bcd02815260206004820152601060248201527f43616e2774207769746864726177203000000000000000000000000000000000604482015290519081900360640190fd5b6040805160a08101825283548183019081526001850154606080840191909152600286015460808401529082528251908101835260038501548152600485015460208281019190915260058601549382019390935291810191909152611354908263ffffffff6122a716565b600160a060020a038086166000908152600660209081526040808320855180518255808401516001830155820151600282015594820151805160038701559182015160048601559081015160059094019390935591519085169183156108fc02918491818181858888f193505050501580156113d4573d6000803e3d6000fd5b505050505050565b600460205260009081526040902054600160a060020a031681565b600054600160a060020a031681565b6000611410612d32565b611418612d32565b8315806114275750600b840615155b1561147c576040805160e560020a62461bcd02815260206004820152601d60248201527f496e76616c69642074726166666963207469636b6574206c656e677468000000604482015290519081900360640190fd5b600092505b838310156108a9576040805160608101909152808686600587018181106114a457fe5b60209081029290920135835250018686600687018181106114c157fe5b60209081029290920135835250018686600787018181106114de57fe5b60200291909101359091525060408051606081019091529092508086866008870181811061150857fe5b602090810292909201358352500186866009870181811061152557fe5b60209081029290920135835250018686600a870181811061154257fe5b60200291909101359091525090506115f085858581811061155f57fe5b6020029190910135905086866001870181811061157857fe5b9050602002013560001916606060020a9004878787600201818110151561159b57fe5b9050602002013560001916606060020a900488888860030181811015156115be57fe5b60200291909101359050898960048a018181106115d757fe5b9050602002013560001916606060020a90048787610a69565b600b83019250611481565b600154600090600160a060020a0316331461161557600080fd5b600160a060020a0382811660009081526004602052604090205416156116ab576040805160e560020a62461bcd02815260206004820152602560248201527f44656c656761746520616c726561647920686173206120666c65657420636f6e60448201527f7472616374000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60015430908390600160a060020a03166116c3612d51565b600160a060020a03938416815291831660208301529091166040808301919091525190819003606001906000f080158015611702573d6000803e3d6000fd5b50600160a060020a038381166000908152600460205260409020805473ffffffffffffffffffffffffffffffffffffffff1916918316919091179055905061174981610f3c565b5050565b33600081815260056020818152604092839020835160a081018552815481860190815260018301546060808401919091526002840154608084015290825285519081018652600383015481526004830154818501529190930154938101939093528101919091526117c4908363ffffffff6129d216565b600160a060020a03909116600090815260056020818152604092839020845180518255808301516001830155840151600282015593810151805160038601559081015160048501559091015191015550565b60006118228383611fbe565b9392505050565b6060600087438110611885576040805160e560020a62461bcd02815260206004820152601760248201527f5469636b65742066726f6d20746865206675747572653f000000000000000000604482015290519081900360640190fd5b600754611896600f6224ea00610ad4565b146118eb576040805160e560020a62461bcd02815260206004820152600b60248201527f57726f6e672065706f6368000000000000000000000000000000000000000000604482015290519081900360640190fd5b841515611942576040805160e560020a62461bcd02815260206004820152601460248201527f496e76616c6964207469636b65742076616c7565000000000000000000000000604482015290519081900360640190fd5b60408051600580825260c08201909252906020820160a080388339505081519194508a91859150600090811061197457fe5b602090810290910101528251600160a060020a038916908490600190811061199857fe5b602090810290910101528251600160a060020a03881690849060029081106119bc57fe5b6020908102909101015282518690849060039081106119d757fe5b6020908102909101015282518590849060049081106119f257fe5b602090810290910101526001611a0784612334565b60408087015187516020808a0151845160008082528184018088529790975260ff9094168486015260608401929092526080830191909152915160a080830194601f198301938390039091019190865af1158015611a69573d6000803e3d6000fd5b505050602060405103519150611a7f8883612492565b611a8d88888488600061257e565b81600160a060020a031687600160a060020a031689600160a060020a03167f39e078a40cc33b8ec6630e5592b3b83cd797752d5f4fba4e0da338160c1a368760405160405180910390a4505050505050505050565b611aec3334612a8d565b565b60025481565b6000611aff836127a1565b600160a060020a038116600090815260066020908152604091829020825160a081018452815481850190815260018301546060808401919091526002840154608084015290825284519081018552600383015481526004830154818501526005909201549382019390935290820152909150611b81908363ffffffff6129d216565b600160a060020a039091166000908152600660209081526040918290208351805182558083015160018301558301516002820155928101518051600385015590810151600484015501516005909101555050565b60035481565b60006106538260000151612b0d565b60006106538260000151612b24565b60006106538260200151612b24565b60006106538260200151612b0d565b6000808080808080808080805b600a54891015611e7757600a80548a908110611c3c57fe5b600091825260209091200154600160a060020a03169750611c5c88612b38565b9650611c6f87606463ffffffff611f9b16565b600160a060020a0389166000908152600b602052604090206001810154919b509650611cb890611ca79061040063ffffffff611e9b16565b60028801549063ffffffff612bb216565b9450600093505b6003860154841015611e2e5760038601805485908110611cdb57fe5b6000918252602080832090910154600160a060020a03168083526004890190915260409091206001810154919c509350611d3290611d219061040063ffffffff611e9b16565b60028501549063ffffffff612bb216565b9150611d6685611d5a8c611d4e8661271063ffffffff611e9b16565b9063ffffffff611e9b16565b9063ffffffff611f9b16565b9150611d728b83611ed4565b5060005b6003830154811015611de3578260040160008460030183815481101515611d9957fe5b6000918252602080832090910154600160a060020a031683528201929092526040018120805460ff1916815560018181018390556002820183905560039091019190915501611d76565b600160a060020a038b1660009081526004870160205260408120805460ff19168155600181018290556002810182905590611e216003830182612d11565b5050600190930192611cbf565b600160a060020a0388166000908152600b60205260408120805460ff19168155600181018290556002810182905590611e6a6003830182612d11565b5050600190980197611c24565b611e83600a6000612d11565b611e8b61101c565b6007555050505050505050505050565b600080831515611eae5760009150611ecd565b50828202828482811515611ebe57fe5b0414611ec957600080fd5b8091505b5092915050565b600081111561174957600160a060020a0382166000908152600960205260409020541515611f5557600880546001810182556000919091527ff3f7a9fe364faab93b216da50a3214154f22a0a2b415b23a84c8169e8b636ee301805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0384161790555b600160a060020a038216600090815260096020526040902054611f7e908263ffffffff612bb216565b600160a060020a0383166000908152600960205260409020555050565b600080808311611faa57600080fd5b8284811515611fb557fe5b04949350505050565b600060ff8316151561204357600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611bdb565b8260ff16600114156120c857600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611bea565b8260ff166002141561214d57600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611bf9565b8260ff166003141561060357600160a060020a038216600090815260056020818152604092839020835160a0810185528154818601908152600183015460608084019190915260028401546080840152908252855190810186526003830154815260048301548185015291909301549381019390935281019190915261047090611c08565b600160a060020a038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152612252908263ffffffff612bc416565b600160a060020a03909216600090815260056020818152604092839020855180518255808301516001830155840151600282015594810151805160038701559081015160048601559091015192019190915550565b6122af612d61565b816122bd8460200151612b0d565b1015612313576040805160e560020a62461bcd02815260206004820152601660248201527f496e737566666963656e742066726565207374616b6500000000000000000000604482015290519081900360640190fd5b6020830151612328908363ffffffff612bef16565b60208401525090919050565b600080606060008085519350836020026040519080825280601f01601f191660200182016040528015612371578160200160208202803883390190505b509250600091505b8382101561242c575060005b602081101561242157858281518110151561239c57fe5b90602001906020020151816020811015156123b357fe5b1a7f010000000000000000000000000000000000000000000000000000000000000002838284602002018151811015156123e957fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600101612385565b600190910190612379565b826040518082805190602001908083835b6020831061245c5780518252601f19909201916020918201910161243d565b5181516020939093036101000a600019018019909116921691909117905260405192018290039091209998505050505050505050565b604080517fd90bd651000000000000000000000000000000000000000000000000000000008152600160a060020a0383811660048301529151849283169163d90bd6519160248083019260209291908290030181600087803b1580156124f757600080fd5b505af115801561250b573d6000803e3d6000fd5b505050506040513d602081101561252157600080fd5b50511515612579576040805160e560020a62461bcd02815260206004820152601360248201527f556e726567697374657265642064657669636500000000000000000000000000604482015290519081900360640190fd5b505050565b600160a060020a0385166000908152600b60205260408120805490919081908190819060ff16151561260d578454600160ff1990911681178655600a805491820181556000527fc65a7bb8d6351c1cf70c95a316cc6a92839c986682d98bc35f958f4883f9d2a801805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038c161790555b600160a060020a03891660009081526004860160205260409020805490945060ff16151561267f578354600160ff1990911681178555600386018054918201815560009081526020902001805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038b161790555b600160a060020a03881660009081526004850160205260409020805490935060ff1615156126f1578254600160ff1990911681178455600385018054918201815560009081526020902001805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a038a161790555b8260020154871115612743576002830180549088905560018501549088039250612721908363ffffffff612bb216565b60018086019190915585015461273d908363ffffffff612bb216565b60018601555b8260030154861115612795575060038201805490869055600284015490860390612773908263ffffffff612bb216565b60028086019190915585015461278f908263ffffffff612bb216565b60028601555b50505050505050505050565b600160a060020a0380821660009081526004602052604081205490911681811561285257600154600160a060020a0316331461284d576040805160e560020a62461bcd02815260206004820152602660248201527f4f6e6c79207468652063726f6e206163636f756e74616e742063616e2063616c60448201527f6c20746869730000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b611ecd565b61286484600160a060020a0316612c74565b15156128ba576040805160e560020a62461bcd02815260206004820152601e60248201527f496e76616c696420666c65657420636f6e747261637420616464726573730000604482015290519081900360640190fd5b83915081600160a060020a0316634fb3ccc56040518163ffffffff1660e060020a028152600401602060405180830381600087803b1580156128fb57600080fd5b505af115801561290f573d6000803e3d6000fd5b505050506040513d602081101561292557600080fd5b50519050600160a060020a0381163314611ecd576040805160e560020a62461bcd02815260206004820152602560248201527f4f6e6c792074686520666c656574206163636f756e74616e742063616e20646f60448201527f2074686973000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b6129b7612d61565b82516129c9908363ffffffff612c7c16565b83525090919050565b6129da612d61565b816129e88460000151612b0d565b1015612a64576040805160e560020a62461bcd02815260206004820152602160248201527f43616e277420756e7374616b65206d6f7265207468616e206973207374616b6560448201527f6400000000000000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b8251612a76908363ffffffff612bef16565b83526020830151612328908363ffffffff612c7c16565b600160a060020a038216600090815260056020818152604092839020835160a08101855281548186019081526001830154606080840191909152600284015460808401529082528551908101865260038301548152600483015481850152919093015493810193909352810191909152612252908263ffffffff6129af16565b6000612b1a826000612c7c565b6040015192915050565b6000612b31826000612c7c565b5192915050565b600160a060020a0381166000908152600660209081526040808320815160a08101835281548184019081526001830154606080840191909152600284015460808401529082528351908101845260038301548152600483015481860152600590920154928201929092529181019190915261065390611bdb565b600082820183811015611ec957600080fd5b612bcc612d61565b825160400151612be2908363ffffffff612bb216565b8351604001525090919050565b612bf7612d87565b612c02836000612c7c565b905081816040015110151515612c62576040805160e560020a62461bcd02815260206004820152601b60248201527f496e737566666963656e742066756e647320746f206465647563740000000000604482015290519081900360640190fd5b60408101805192909203909152919050565b6000903b1190565b612c84612d87565b612c8d83612d00565b1515612cc957604080516060810182528381524360208201528451858301519192830191612cc09163ffffffff612bb216565b90529050610653565b604080516060810190915283518190612ce8908563ffffffff612bb216565b81524360208201526040858101519101529050610653565b602001516202ac6043919091031090565b5080546000825590600052602060002090810190612d2f9190612da9565b50565b6060604051908101604052806003906020820280388339509192915050565b60405161048480612dc883390190565b60c060405190810160405280612d75612d87565b8152602001612d82612d87565b905290565b6060604051908101604052806000815260200160008152602001600081525090565b61102391905b80821115612dc35760008155600101612daf565b50905600608060405234801561001057600080fd5b5060405160608061048483398101604090815281516020830151919092015160018054600160a060020a03938416600160a060020a03199182161790915560008054948416948216949094179093556002805492909116919092161790556104078061007d6000396000f3006080604052600436106100ae5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416633c5f7d4681146100b35780634fb3ccc5146100db57806364c69c7d1461010c57806376bd31a8146101415780638da5cb5b14610162578063a0619d4a14610177578063a58bbebd14610198578063b13aa78a146101be578063b655bd5f146101df578063b92c8c8014610205578063d90bd6511461022b575b600080fd5b3480156100bf57600080fd5b506100d9600160a060020a0360043516602435151561024c565b005b3480156100e757600080fd5b506100f061028e565b60408051600160a060020a039092168252519081900360200190f35b34801561011857600080fd5b5061012d600160a060020a036004351661029d565b604080519115158252519081900360200190f35b34801561014d57600080fd5b5061012d600160a060020a03600435166102b2565b34801561016e57600080fd5b506100f06102c7565b34801561018357600080fd5b5061012d600160a060020a03600435166102d6565b3480156101a457600080fd5b506100d9600160a060020a036004351660243515156102eb565b3480156101ca57600080fd5b5061012d600160a060020a036004351661032d565b3480156101eb57600080fd5b506100d9600160a060020a03600435166024351515610342565b34801561021157600080fd5b506100d9600160a060020a03600435166024351515610384565b34801561023757600080fd5b5061012d600160a060020a03600435166103c6565b600154600160a060020a0316331461026357600080fd5b600160a060020a03919091166000908152600860205260409020805460ff1916911515919091179055565b600254600160a060020a031681565b60096020526000908152604090205460ff1681565b60066020526000908152604090205460ff1681565b600154600160a060020a031681565b600a6020526000908152604090205460ff1681565b600154600160a060020a0316331461030257600080fd5b600160a060020a03919091166000908152600a60205260409020805460ff1916911515919091179055565b60076020526000908152604090205460ff1681565b600154600160a060020a0316331461035957600080fd5b600160a060020a03919091166000908152600760205260409020805460ff1916911515919091179055565b600154600160a060020a0316331461039b57600080fd5b600160a060020a03919091166000908152600960205260409020805460ff1916911515919091179055565b60086020526000908152604090205460ff16815600a165627a7a7230582068e71914f0520e516858cedb88c18ccc48f386c0b117656a98208c3e1bd760c60029a165627a7a723058206b59fe05edb2981729c5946e0c80765320f1bf0d4d9f84fdc226708faf0fd54a0029"
  end
end
